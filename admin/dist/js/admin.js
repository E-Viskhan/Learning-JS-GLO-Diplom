(()=>{"use strict";const e=async e=>{try{const t=await fetch(e);if(!t.ok)throw new Error("Произошла ошибка, данных нет!");return await t.json()}catch(e){console.error(e.message)}},t=async({url:e,data:t,method:n="POST"})=>{try{if(!(await fetch(e,{method:n,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw new Error("Произошла ошибка, данных нет!")}catch(e){console.error(e.message)}},n="http://localhost:3000/services/",s=e=>{const t=document.getElementById("tbody");t.innerHTML="",e.forEach((e=>{const n=(({type:e,name:t,units:n,cost:s,id:c})=>`<tr class="table__row">\n    <td class="table__id table__cell">${c}</td>\n    <td class="table-type table__cell">${e}</td>\n    <td class="table-name table__cell">${t}</td>\n    <td class="table-units table__cell">${n}</td>\n    <td class="table-cost table__cell">${s} руб</td>\n    <td>\n      <div class="table__actions table__cell">\n        <button class="button action-change">\n          <span class="svg_ui">\n            <svg class="action-icon_change">\n              <use xlink:href="./img/sprite.svg#change"></use>\n            </svg>\n          </span>\n          <span>Изменить</span>\n        </button>\n        <button class="button action-remove">\n          <span class="svg_ui">\n            <svg class="action-icon_remove">\n              <use xlink:href="./img/sprite.svg#remove"></use>\n            </svg>\n          </span>\n          <span>Удалить</span>\n        </button>\n      </div>\n    </td>\n  </tr>`)(e);t.insertAdjacentHTML("beforeend",n)}))},c=()=>{document.body.style.marginRight="0",document.body.style.overflow="auto"};"true"!==(e=>{let t=document.cookie.match(new RegExp("(?:^|; )"+"access".replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0})()&&(document.location.href="index.html"),window.apiService=new class{async getServices(){return e(n)}async getService(t){return e(n+t)}async addService(e){return t({url:n,data:e})}async removeService(e){return t({url:n+e,method:"DELETE"})}async changeService(e,s){return t({url:n+e,data:s,method:"PATCH"})}async replaceService(e,s){return t({url:n+e,data:s,method:"PUT"})}async filterServices(t){return e(`${n}?type=${t}`)}async filterUsers(t){return e(`http://localhost:4545/users?${t}=true`)}async getSortUsers({sortOptionName:t,order:n}){return e(`http://localhost:4545/users?_sort=${t}&_order=${n}`)}async getSearchUsers(t){return e(`http://localhost:4545/users?name_like=${t}`)}},apiService.getServices().then((e=>s(e))),(async()=>{const e=document.getElementById("typeItem");(await(async()=>fetch("http://localhost:3000/services/").then((e=>e.json())).then((e=>{const t=new Set;return e.forEach((e=>t.add(e.type))),t})))()).forEach((t=>{const n=`<option value="${s=t}">${s}</option>`;var s;e.insertAdjacentHTML("beforeend",n)}))})(),(()=>{const e=document.getElementById("typeItem");e.addEventListener("change",(async t=>{let n,c=e.value;n="Все услуги"===c?await apiService.getServices():await apiService.filterServices(c),s(n)}))})(),(()=>{const e=document.querySelector(".btn-addItem"),t=document.getElementById("modal"),n=document.getElementById("form"),o=()=>{t.classList.toggle("d-none")};e.addEventListener("click",(e=>{o(),document.body.style.marginRight=`${(()=>{let e=0;if(Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)>document.documentElement.clientHeight){let t=document.createElement("div");t.style.width="500px",t.style.height="500px",t.style.overflowY="scroll",t.style.visibility="hidden",document.body.appendChild(t),e=t.offsetWidth-t.clientWidth,t.remove()}return e})()}px`,document.body.style.overflow="hidden"})),t.addEventListener("click",(e=>{e.preventDefault();const t=e.target;if(t.classList.contains("modal__overlay")||t.closest(".button__close")||t.closest(".cancel-button"))n.reset(),o(),c();else if(t.closest("#submit")){const e=new FormData(n);let t={};for(let[n,s]of e)t[n]=s;apiService.addService(t).then((()=>{apiService.getServices().then((e=>s(e)))})),n.reset(),o(),c()}}))})()})();